{"version":3,"sources":["app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"site.js","sourcesContent":["(function() {\r\n\r\n// Initialize Firebase\r\nvar config = {\r\n\tapiKey: \"AIzaSyBuN0-VcY1ZyCxJWmW2er0hWFfCrc5kHOc\",\r\n\tauthDomain: \"geo-license.firebaseapp.com\",\r\n\tdatabaseURL: \"https://geo-license.firebaseio.com\",\r\n   \tstorageBucket: \"geo-license.appspot.com\",\r\n\tmessagingSenderId: \"6432295404\"\r\n};\r\n// Get a reference to the database service\r\nfirebase.initializeApp(config);\r\ns\r\nvar app = angular.module('licenseApp', ['chieffancypants.loadingBar', 'firebase'], function($interpolateProvider) {\r\n\t$interpolateProvider.startSymbol('[[');\r\n\t$interpolateProvider.endSymbol(']]');\r\n}).config(function(cfpLoadingBarProvider) {\r\n\tcfpLoadingBarProvider.includeSpinner = false; // toggle spinner\r\n    cfpLoadingBarProvider.includeBar = true; // toggle loading bar\r\n});\r\n\r\napp.controller('loginController', function($scope, $http) {\r\n\r\n\t$scope.greet = \"Hello!\";\r\n\t$scope.welcome = [\"Hola!\",\"Indo!\",\"Bonjour!\",\"Ciao!\",\"Ola!\",\"Namaste!\",\"Salaam!\",\"Konnichiwa!\",\"Merhaba!\",\"Jambo!\",\"Ni Hau!\",\"Hallo!\",\"Hello!\"];\r\n\t$scope.greet = $scope.welcome[Math.floor(Math.random() * $scope.welcome.length)];\r\n\t$scope.errorCode = false;\r\n\r\n\t// get auth methods from database\r\n\tvar auth = firebase.auth();\r\n\r\n\t// getting the elements\r\n\tvar txtEmail = $(\"input#email\");\r\n\tvar txtPassword = $(\"input#password\");\r\n\tvar txtToken = $(\"input#token\");\r\n\tvar btnLogin = $(\"button#login\");\r\n\tvar card = $(\"div.card\");\r\n\tvar cardAction = card.find(\"div.card-action\");\r\n\r\n\t// add login event\r\n\tbtnLogin.click(function(e) {\r\n\t    // get email and pass\r\n\t    var email = txtEmail.val();\r\n\t    var pass = txtPassword.val();\r\n\t    var token = txtToken.val();\r\n\r\n\t\t// sign in\r\n\t\tauth.signInWithEmailAndPassword(email, pass).then(function() {\r\n\t\t  \t// Sign-in successful.\r\n\t\t  \t// Send token to your backend via HTTPS\r\n\t\t  \tcardAction.fadeOut(1000);\r\n\t\t\t$http.post('./login', {\r\n\t\t\t\t\"_token\":\t\t\ttoken,\r\n\t\t\t\t\"email\":\t\t\temail,\r\n\t\t\t\t\"password\":\t\t\tpass\r\n\t\t\t}).then(function successCallback(response) {\r\n\t\t\t\t$scope.greet = \"Your account is being validated. Have a nice day! :)\";\r\n\t\t\t  \twindow.location.replace('./license');\r\n\t\t\t}, function errorCallback(response) {\r\n\t\t\t\tconsole.log(response);\r\n\t\t\t\t$scope.errorCode = true;\r\n\t\t\t\t$scope.errorMessage = response;\r\n\t\t  \t\tcardAction.fadeIn(1000);\r\n\t\t\t\tauth.signOut();\r\n\t\t\t\t// called asynchronously if an error occurs\r\n\t\t\t\t// or server returns response with an error status.\r\n\t\t\t});\r\n\t\t}, function(error) {\r\n\t\t\t// Handle Errors here.\r\n\t\t\tconsole.log(errorMessage);\r\n\t\t\t$scope.errorCode = error.code;\r\n\t\t\t$scope.errorMessage = error.message;\r\n\t\t});\r\n\t});\r\n\r\n\t// check for user state changes\r\n\t// auth.onAuthStateChanged(function(user) {\r\n\t//   if (user) {\r\n\t//     // User is signed in.\r\n\t//     console.log(user);\r\n\t//   } else {\r\n\t//     console.log(\"no user\");\r\n\t//   }\r\n\t// });\r\n});\r\n\r\napp.controller('licenseController', function($scope, $interval, $http, $filter, $firebaseObject, $firebaseArray) {\r\n\r\n\t// download the data into a local object\r\n\tvar ref = firebase.database().ref();\r\n\r\n\t// get auth methods from database\r\n\tvar auth = firebase.auth();\r\n\r\n\t$scope.licenses = [];\r\n\t$scope.genData = [];\r\n\t$scope.act_date = \"...\";\r\n\t$scope.genData.status = 0;\r\n\t$scope.license = \"\";\r\n\t$scope.sortType = 'act_date'; // set the default sort type\r\n\t$scope.sortReverse = false; // set the default sort order\r\n\t$scope.searchLicense = \"\"; // set the default search/filter term\r\n\t$scope.placeholder = \"I'm feeling lucky\"; // set the default search/filter term\r\n\t$scope.licenses = $firebaseArray(ref.child(\"licenses\")); // populate licenses from firebase\r\n\r\n\tvar pholder = ref.child('greetings');\r\n\r\n\tpholder.on('value', snap => $scope.placeholder = snap.val()); // sync object changes using on()\r\n\r\n\t// controls the ticking time on adding a license\r\n\tvar tick = function() {\r\n\t\t$scope.act_date = new Date();\r\n\t}\r\n\r\n\tvar onModalHide = function() {\r\n\t\t$scope.licgenform.$setPristine();\r\n\t\t$scope.licgenform.$setUntouched();\r\n\t};\r\n\r\n\t// handler controllers\r\n\t$scope.handlers = function() {\r\n\t    $(\"#menu-toggle\").click(function(e) {\r\n\t        e.preventDefault();\r\n\t        $(\"#wrapper\").toggleClass(\"toggled\");\r\n\t    });\r\n\r\n\t\t$(\"#close_instruction\").click(function(e) {\r\n\t        e.preventDefault();\r\n\t        $(this).parent().parent().parent().fadeOut();\r\n\t    });\r\n\r\n\t\t$(\"#addLicenseModal\").modal({\r\n\t\t    complete : onModalHide\r\n\t\t});\r\n\r\n\t\t$(\"#genLicenseModal\").modal({\r\n\t\t    complete : onModalHide\r\n\t\t});\r\n\r\n\t\t$(\"a#logout\").click(function(e) {\r\n\t\t\tauth.signOut();\r\n\t    });\r\n\t\t\r\n\t\ttick();\r\n\t\t$interval(tick, 1000);\r\n\t}\r\n\r\n\t// parse string and int with 000\r\n\tfunction pad(str, max) {\r\n\r\n\t\tstr = str.toString();\r\n\t\treturn str.length < max ? pad(\"0\" + str, max) : str;\r\n\t}\r\n\r\n\t// adds license\r\n\t$scope.addLicense = function() {\r\n\r\n\t\t// gets js datetime ready for mysql datetime\r\n\t\tvar act_date = $scope.act_date.toISOString().slice(0, 19).replace('T', ' ');\r\n\t\tvar timestamp = new Date().valueOf(); // get id based time\r\n\r\n\t\t$(\"#addLicenseModal\").modal(\"close\");\r\n\r\n\t\t$scope.licenses.$add({\r\n\t\t\t\"id\":\t\t\ttimestamp,\r\n\t\t\t\"act_code\":\t\t$scope.newLic.act_code,\r\n\t\t\t\"organization\":\t$scope.newLic.organization,\r\n\t\t\t\"status\":\t\t$scope.newLic.status,\r\n\t\t\t\"device_code\":\t$scope.newLic.device_code = 0,\r\n\t\t\t\"project\":\t\t$scope.newLic.project,\r\n\t\t\t\"act_date\":\t\tact_date\r\n\t    }).then(function() {\r\n\t\t\t// adds the new license to the view\r\n\t\t\t$scope.newLic = \"\"; // clears the input fields\r\n\t\t\t$scope.newLic.status = 0;\r\n\t\t\t// reset errors on the input\r\n\t\t\t$scope.addlicform.$setPristine();\r\n\t\t\t$scope.addlicform.$setUntouched();\r\n\t\t}, function(error) {\r\n\t\t\tMaterialize.toast(\"Something went wrong! \" + error, 4000, 'red');\r\n\t\t});\r\n\t};\r\n\r\n\t// gets the license details ready for edit\r\n\t// makes the table row editabel\r\n\t$scope.getLicense = function(license) {\r\n\r\n\t\t// change the button to edit mode using angular filter array\r\n\t\tvar id = license.$id;\r\n\t\tref.child(\"licenses\").child(id).update({\"editing\": 1});\r\n\r\n\t\t// var el = $('tr#'+ license.id);\r\n\t\t// el.find('input[data=\"canEdit\"]').removeAttr('readonly');\r\n\t};\r\n\r\n\t// updates the editable license\r\n\t$scope.updateLicense = function(license) {\r\n\r\n\t\tvar id = license.$id;\r\n\t\t// ref.child(\"licenses\").child(id).update({\"loading\": 1});\r\n\r\n\t\tif (license.status == undefined) {\r\n\t\t\tconsole.debug(\"status: Must be a boolean value (0,1)\");\r\n\t\t\tlicense.status = 0;\r\n\t\t}\r\n\r\n\t\tvar licenseData = $scope.licenses.$getRecord(id);\r\n\r\n\t\tvar postData = {\r\n\t\t\t\"id\":\t\t\tlicenseData.id,\r\n\t\t\t\"act_code\":\t\tlicenseData.act_code,\r\n\t\t\t\"organization\":\tlicenseData.organization,\r\n\t\t\t\"status\":\t\tlicenseData.status,\r\n\t\t\t\"device_code\":\tlicenseData.device_code,\r\n\t\t\t\"project\":\t\tlicenseData.project,\r\n\t\t\t\"act_date\":\t\tlicenseData.act_date\r\n\t\t};\r\n\r\n\t\t// Write the new post's data simultaneously in the posts list and the user's post list.\r\n\t\tvar updates = {};\r\n\t\tupdates['/licenses/' + id] = postData;\r\n\r\n\t\tref.update(updates).then(function() {\r\n\t\t}, function(error) {\r\n\t\t\tMaterialize.toast(\"Something went wrong! \" + error, 4000, 'red');\r\n\t\t});\r\n\t};\r\n\r\n\t$scope.toDelete = function(license) {\r\n\r\n\t\tvar id = license.$id;\r\n\t\tvar licenseData = $scope.licenses.$getRecord(id);\r\n\r\n\t\tlicenseData.confirmDelete = true;\r\n\r\n\t\t$scope.deleteindex = license;\r\n\t};\r\n\r\n\t// deletes the motha fucka license :D\r\n\t$scope.deleteLicense = function(license) {\r\n\r\n\t\t$scope.licenses.$remove(license)\r\n\t};\r\n\r\n\t// generates license(s)\r\n\t$scope.generate = function() {\r\n\r\n\t\tvar licToGen = $scope.genData.toGenerate;\r\n\t\tvar licensesAct = $scope.genData.act_code;\r\n\t\tvar prefix = $scope.genData.prefix;\r\n\r\n\t\t$(\"#genLicenseModal\").modal(\"close\");\r\n\r\n\t\tif (licToGen) {\r\n\t\t\tvar act_date = $scope.act_date.toISOString().slice(0, 19).replace('T', ' ');\r\n\t\t\tvar timestamp = new Date().valueOf(); // get id based time\r\n\t\t\tvar codeIndex = prefix;\r\n\t\t\tfor (var i = licToGen - 1; i >= 0; i--) {\r\n\t\t\t\tvar act_code = licensesAct + pad(codeIndex, 3);\r\n\r\n\t\t\t\t$scope.licenses.$add({\r\n\t\t\t\t\t\"id\"\t\t\t: timestamp,\r\n\t\t\t\t\t\"act_code\"\t\t: act_code,\r\n\t\t\t\t\t\"organization\" \t: $scope.genData.organization,\r\n\t\t\t\t\t\"status\"\t\t: $scope.genData.status,\r\n\t\t\t\t\t\"device_code\"\t: 0,\r\n\t\t\t\t\t\"project\"\t\t: $scope.genData.project,\r\n\t\t\t\t\t\"act_date\"\t\t: act_date\r\n\t\t\t    }).then(function() {\r\n\t\t\t\t\t// adds the new license to the view\r\n\t\t\t\t\t$scope.genData = \"\"; // clears the input fields\r\n\t\t\t\t\t$scope.genData.toGenerate = 1;\r\n\t\t\t\t\t// reset errors on the input\r\n\t\t\t\t\t$scope.licgenform.$setPristine();\r\n\t\t\t\t\t$scope.licgenform.$setUntouched();\r\n\t\t\t\t}, function(error) {\r\n\t\t\t\t\tMaterialize.toast(\"Something went wrong! \" + error, 4000, 'red');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcodeIndex++;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t$scope.handlers();\r\n});\r\n\r\n// nothing fancy custom directives // =====================================================/\r\n// retrieves the licenses view from licenses.html\r\napp.directive('licenses', function() {\r\n  return {\r\n  \trestrict: 'E',\r\n    templateUrl: 'js/templates/licenses.html'\r\n  };\r\n});\r\n\r\n// app.directive('licmenu', function() {\r\n//   return {\r\n//     templateUrl: 'js/templates/lic-menu.html'\r\n//   };\r\n// });\r\n\r\napp.directive('addlicense', function() {\r\n  return {\r\n  \trestrict: 'E',\r\n    templateUrl: 'js/templates/add-license.html'\r\n  };\r\n});\r\n\r\napp.directive('genlicense', function() {\r\n  return {\r\n  \trestrict: 'E',\r\n    templateUrl: 'js/templates/gen-license.html'\r\n  };\r\n});\r\n\r\napp.directive('deletelicense', function() {\r\n  return {\r\n  \trestrict: 'E',\r\n    templateUrl: 'js/templates/delete-license.html'\r\n  };\r\n});\r\n\r\n}());\r\n"]}